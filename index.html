<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Escape Room Matem√°tico</title>

<style>
:root{
  --bg:#0b1020;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:rgba(255,255,255,.92);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI;
  background:radial-gradient(1200px 700px at 30% 10%, rgba(116,192,252,.20), transparent 60%),var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.app{
  width:min(980px,100%);
  background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.03));
  border:1px solid var(--border);
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  overflow:hidden;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:rgba(0,0,0,.25);
  border-bottom:1px solid var(--border);
}
.badge{
  background:rgba(255,255,255,.1);
  border:1px solid var(--border);
  padding:8px 12px;
  border-radius:999px;
  font-weight:700;
}
main{padding:18px}
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
}
.question{
  font-size:22px;
  font-weight:800;
  margin:12px 0;
}
.answers button{
  width:100%;
  margin-top:10px;
}
button{
  background:rgba(255,255,255,.08);
  color:white;
  border:1px solid var(--border);
  padding:14px;
  border-radius:14px;
  font-size:16px;
  cursor:pointer;
}
button.primary{
  background:rgba(116,192,252,.25);
  font-weight:800;
}
.chips{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:10px;
}
.chip{
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.15);
  font-weight:900;
  letter-spacing:.6px;
}
input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.3);
  color:white;
  font-size:16px;
  margin-top:10px;
}
.progress{
  height:8px;
  background:rgba(255,255,255,.1);
  border-radius:999px;
  overflow:hidden;
  margin-bottom:12px;
}
.progress div{
  height:100%;
  width:0%;
  background:#74c0fc;
}
</style>
</head>

<body>
<div class="app">
<header>
  <div class="badge" id="stage">üóùÔ∏è Sala 1/4 ¬∑ Pregunta 1/5</div>
  <div style="display:flex;gap:10px">
    <button id="musicBtn" class="badge">üîá M√∫sica</button>
    <div class="badge" id="timer">‚è≥ 12:00</div>
  </div>
</header>

<main>
  <div class="panel">
    <div class="progress"><div id="bar"></div></div>
    <div id="screen"></div>
  </div>
</main>
</div>

<script>
/* ====== DATOS ====== */
const GAME=[
{w:"MAGIA",q:[
["(‚àí3)+5√ó2‚àí4",["7","‚àí1","3"],["X","K","I"]],
["8‚àí(‚àí2)√ó3+1",["11","15","3"],["B","A","G"]],
["(‚àí5)√ó2+8√∑(‚àí4)",["‚àí12","‚àí14","‚àí8"],["G","O","F"]],
["12√∑(‚àí3)+(‚àí2)√ó5",["‚àí18","‚àí6","‚àí14"],["U","P","A"]],
["(‚àí6)+4√ó(‚àí2)‚àí3",["‚àí17","‚àí13","‚àí11"],["M","Q","S"]]
]},
{w:"BRUJA",q:[
["35% de 200",["70","65","75"],["J","U","M"]],
["60% es 48",["80","88","72"],["U","M","B"]],
["18 de 72 (%)",["30%","20%","25%"],["Z","N","B"]],
["150‚Ç¨ +20%",["180‚Ç¨","190‚Ç¨","170‚Ç¨"],["A","Z","I"]],
["200‚Ç¨ ‚àí15%",["160‚Ç¨","170‚Ç¨","180‚Ç¨"],["P","R","K"]]
]},
{w:"HADAS",q:[
["4 m ‚Üí 24‚Ç¨, 7 ‚Üí ?",["38‚Ç¨","46‚Ç¨","42‚Ç¨"],["C","C","A"]],
["6 L/100km en 350km",["18","21","24"],["J","A","T"]],
["18 ‚Üí 450g, 12 ‚Üí ?",["350","250","300"],["Y","T","D"]],
["8 obreros 15 d√≠as, 12 ‚Üí ?",["10","8","12"],["H","S","K"]],
["Piscina 12h, 3 mangueras",["6","4","3"],["M","S","G"]]
]},
{w:"PODER",q:[
["(‚àí4)+3√ó(‚àí5)",["‚àí19","‚àí11","11"],["R","Z","F"]],
["2,4 √ó 10",["2,4","0,24","24"],["G","R","E"]],
["0,75 equivale a",["3/4","2/5","1/3"],["D","U","V"]],
["5 cuestan 12‚Ç¨, 8 ‚Üí ?",["20","18","19,2"],["N","J","P"]],
["6 pers 300g, 10 ‚Üí ?",["450","500","600"],["X","O","C"]]
]}
];

let s=0,p=0,letras=[],intentos=3,time=720,clock;

/* ====== AUDIO ====== */
let ctx,osc,gain,on=false;
musicBtn.onclick=()=>{
  if(!ctx){
    ctx=new AudioContext();
    osc=ctx.createOscillator();
    gain=ctx.createGain();
    osc.type="sawtooth"; osc.frequency.value=55;
    osc.connect(gain).connect(ctx.destination);
    osc.start();
  }
  on=!on;
  gain.gain.linearRampToValueAtTime(on?.3:0,ctx.currentTime+.3);
  musicBtn.textContent=on?"üîä M√∫sica":"üîá M√∫sica";
};

/* ====== TIMER ====== */
function startTimer(){
  clearInterval(clock);
  time=720;
  clock=setInterval(()=>{
    time--;
    timer.textContent="‚è≥ "+String(time/60|0).padStart(2,"0")+":"+String(time%60).padStart(2,"0");
    if(time<=0) restartSala();
  },1000);
}

/* ====== RENDER ====== */
function render(){
  stage.textContent=`üóùÔ∏è Sala ${s+1}/4 ¬∑ Pregunta ${p+1}/5`;
  bar.style.width=(p/5*100)+"%";
  const q=GAME[s].q[p];
  screen.innerHTML=`
    <div class="question">${q[0]}</div>
    <div class="answers">
      ${q[1].map((t,i)=>`<button onclick="pick('${q[2][i]}')">${t}</button>`).join("")}
    </div>
    <h3>Letras obtenidas</h3>
    <div class="chips">${letras.map(l=>`<span class="chip">${l}</span>`).join("")}</div>
  `;
}

function pick(l){
  letras.push(l);
  p++;
  p<5?render():renderWord();
}

function renderWord(msg=""){
  stage.textContent=`üóùÔ∏è Sala ${s+1}/4 ¬∑ Palabra`;
  bar.style.width="100%";
  screen.innerHTML=`
    <h2>üîí Cerradura</h2>
    <p>Intentos restantes: <b>${intentos}</b></p>
    <div class="chips">${letras.map(l=>`<span class="chip">${l}</span>`).join("")}</div>
    <input id="w" placeholder="Escribe la palabra final">
    <button class="primary" onclick="check()">COMPROBAR</button>
    <p>${msg}</p>
  `;
}

function check(){
  const v=document.getElementById("w").value.toUpperCase();
  if(v===GAME[s].w){
    s++;
    if(s>=GAME.length){
      screen.innerHTML="<h1>üèÜ ¬°ESCAPE COMPLETADO!</h1>";
      clearInterval(clock);
    } else restartSala();
  }else{
    intentos--;
    intentos>0?renderWord("‚õî"):restartSala();
  }
}

function restartSala(){
  p=0; letras=[]; intentos=3;
  startTimer(); render();
}

/* ====== START ====== */
startTimer();
render();
</script>
</body>
</html>
