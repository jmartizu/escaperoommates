
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Escape Room Matem√°tico</title>

<style>
:root{--bg:#0b1020;--text:rgba(255,255,255,.92);--muted:rgba(255,255,255,.7)}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;
  background:radial-gradient(1200px 700px at 30% 10%, rgba(116,192,252,.2), transparent 60%),var(--bg);
  color:var(--text);
  min-height:100vh;display:flex;justify-content:center;align-items:center;padding:18px
}
.app{width:min(980px,100%);background:rgba(255,255,255,.05);border-radius:20px;overflow:hidden}
header{display:flex;justify-content:space-between;padding:14px;background:rgba(0,0,0,.2)}
.badge{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.1);font-weight:700}
main{padding:18px}
.panel{background:rgba(255,255,255,.06);border-radius:16px;padding:18px;transition:background .4s}
.panel.success{background:rgba(0,180,0,.25)}
.panel.fail{background:rgba(200,0,0,.25)}
.question{font-size:22px;font-weight:800;margin-top:8px}
.answers{display:grid;gap:10px;margin-top:14px}
button{background:rgba(255,255,255,.08);color:white;border:none;padding:14px;border-radius:14px;font-size:16px;cursor:pointer}
button.primary{background:#74c0fc;font-weight:800}
.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.chip{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.15);font-weight:900}
input{width:100%;padding:14px;border-radius:14px;border:none;margin-top:10px;font-size:16px}
.progress{height:8px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden;margin-bottom:12px}
.progress div{height:100%;background:#74c0fc;width:0%}
.small{font-size:13px;color:var(--muted);margin-top:10px}
video{width:100%;border-radius:14px}
</style>
</head>

<body>
<div class="app">
<header>
  <div class="badge" id="stage">ü™Ñ Introducci√≥n</div>
  <div class="badge" id="timer">‚è≥ 12:00</div>
</header>

<main>
  <div class="panel" id="panel">
    <div class="progress"><div id="bar"></div></div>
    <div id="screen"></div>
  </div>
  <div class="small">Pulsa F11 para pantalla completa</div>
</main>
</div>

<script>
/* ================= DATOS ================= */
const GAME=[
{w:"MAGIA",q:[
["Calcula: (-3)+5*2-4",["7","-1","3"],["X","K","I"],2],
["Resuelve: 8-(-2)*3+1",["11","15","3"],["B","A","G"],1],
["Calcula: (-5)*2+8/(-4)",["-12","-14","-8"],["G","O","F"],0],
["Resuelve: 12/(-3)+(-2)*5",["-18","-6","-14"],["U","P","A"],2],
["Calcula: (-6)+4*(-2)-3",["-17","-13","-11"],["M","Q","S"],0]
]},
{w:"BRUJA",q:[
["¬øCu√°l es el 35% de 200?",["70","65","75"],["J","U","M"],0],
["Si el 60% de un n√∫mero es 48, ¬øcu√°l es el n√∫mero?",["80","88","72"],["U","M","B"],0],
["¬øQu√© porcentaje representa 18 de 72?",["30%","20%","25%"],["Z","N","B"],2],
["Un art√≠culo cuesta 150 ‚Ç¨. Si sube un 20 %, ¬ønuevo precio?",["180‚Ç¨","190‚Ç¨","170‚Ç¨"],["A","Z","I"],0],
["Una bici cuesta 200 ‚Ç¨. Descuento 15 %. ¬øPrecio final?",["160‚Ç¨","170‚Ç¨","180‚Ç¨"],["P","R","K"],1]
]},
{w:"HADAS",q:[
["Si 4 m cuestan 24 ‚Ç¨, ¬øcu√°nto 7 m?",["38‚Ç¨","46‚Ç¨","42‚Ç¨"],["C","C","A"],2],
["Un coche consume 6 L/100 km. En 350 km:",["18 L","21 L","24 L"],["J","A","T"],1],
["18 pasteles usan 450 g. 12 pasteles:",["350 g","250 g","300 g"],["Y","T","D"],2],
["8 obreros hacen un muro en 15 d√≠as. 12 obreros:",["10","8","12"],["H","S","K"],0],
["1 manguera llena piscina en 12 h. 3 mangueras:",["6 h","4 h","3 h"],["M","S","G"],1]
]},
{w:"PODER",q:[
["Calcula: (-4)+3*(-5)",["-19","-11","11"],["R","Z","F"],0],
["Resuelve: 2,4*10",["2,4","0,24","24"],["G","R","E"],2],
["Fracci√≥n equivalente a 0,75:",["3/4","2/5","1/3"],["D","U","V"],0],
["5 cuadernos cuestan 12 ‚Ç¨. 8 cuadernos:",["20‚Ç¨","18‚Ç¨","19,2‚Ç¨"],["N","J","P"],2],
["Receta 6 pers = 300 g. Para 10 pers:",["450 g","500 g","600 g"],["X","O","C"],1]
]},
{w:"RUNAS",q:[
["2/3 + 1/4",["11/12","3/7","6/12","8/12"],["R","U","N","A"],0],
["5/6 - 1/3",["1/2","4/3","2/3","1/6"],["U","R","A","S"],0],
["3/4 * 2/5",["3/10","6/20","5/9","6/9"],["N","R","U","A"],0],
["2/3 √∑ 4/9",["3/2","8/27","6/12","2/3"],["A","U","R","N"],0],
["1/2 + 3/8 - 1/4",["5/8","3/8","7/8","1/8"],["S","R","U","N"],0]
]}
];

/* ================= ELEMENTOS ================= */
const stage=document.getElementById("stage");
const timer=document.getElementById("timer");
const bar=document.getElementById("bar");
const screen=document.getElementById("screen");
const panel=document.getElementById("panel");

/* ================= ESTADO ================= */
let sala=0,p=0,letras=[],intentos=3,t=720,clk=null;

/* ================= INTRO ================= */
function renderIntro(){
  stage.textContent="ü™Ñ Misi√≥n inicial";
  timer.textContent="‚è≥ 12:00";
  bar.style.width="0%";
  screen.innerHTML=`
    <h1>ü™Ñ El Hechizo del Conocimiento</h1>
    <p>El conocimiento matem√°tico ha sido sellado.</p>
    <p>Superad las salas para romper el hechizo.</p>
    <button class="primary" onclick="startGame()">üöÄ COMENZAR MISI√ìN</button>
  `;
}

/* ================= TIMER ================= */
function startTimer(){
  clearInterval(clk);
  t=720;
  clk=setInterval(()=>{
    t--;
    timer.textContent=\`‚è≥ \${String(t/60|0).padStart(2,"0")}:\${String(t%60).padStart(2,"0")}\`;
    if(t<=0) reiniciarSala();
  },1000);
}

/* ================= JUEGO ================= */
function startGame(){
  sala=0;p=0;letras=[];intentos=3;
  startTimer();renderPregunta();
}

function renderPregunta(){
  panel.className="panel";
  stage.textContent=\`üóùÔ∏è Sala \${sala+1}/5 ¬∑ Pregunta \${p+1}/5\`;
  bar.style.width=(p/5*100)+"%";

  const q=GAME[sala].q[p];
  screen.innerHTML=`
    <div class="question">${q[0]}</div>
    <div class="answers">
      ${q[1].map((t,i)=>`<button onclick="elegir(${i})">${t}</button>`).join("")}
    </div>
    <div class="chips">${letras.map(l=>`<span class="chip">${l}</span>`).join("")}</div>
  `;
}

function elegir(i){
  const q=GAME[sala].q[p];
  const correcta=i===q[3];
  const letra=q[2][i];
  letras.push(letra);

  screen.innerHTML=`
    <h1>${correcta?"‚úÖ ¬°Respuesta correcta!":"‚ùå Respuesta incorrecta"}</h1>
    <p>Letra obtenida: <b>${letra}</b></p>
    <button class="primary" onclick="continuar()">CONTINUAR</button>
  `;
}

function continuar(){
  p++;
  p<5 ? renderPregunta() : renderPalabra();
}

function renderPalabra(msg=""){
  stage.textContent=\`üóùÔ∏è Sala \${sala+1}/5 ¬∑ Palabra\`;
  bar.style.width="100%";
  screen.innerHTML=`
    <p>Intentos restantes: <b>${intentos}</b></p>
    <div class="chips">${letras.map(l=>`<span class="chip">${l}</span>`).join("")}</div>
    <input id="w" placeholder="Escribe la palabra final">
    <button class="primary" onclick="comprobar()">COMPROBAR</button>
    <p>${msg}</p>
  `;
}

function comprobar(){
  const v=document.getElementById("w").value.toUpperCase().trim();
  if(v===GAME[sala].w){
    panel.classList.add("success");
    screen.innerHTML=`
      <h1>üéâ ¬°¬° ENHORABUENA !!</h1>
      <button class="primary" onclick="siguienteSala()">CONTINUAR</button>
    `;
  }else{
    panel.classList.add("fail");
    intentos--;
    setTimeout(()=>panel.className="panel",400);
    intentos>0?renderPalabra("‚ùå Incorrecta"):reiniciarSala();
  }
}

function siguienteSala(){
  sala++;
  if(sala>=GAME.length){
    clearInterval(clk);
    stage.textContent="üèÜ Final";
    screen.innerHTML=`
      <h1>üèÜ ESCAPE COMPLETADO</h1>
      <video src="puerta.mp4.mp4" autoplay controls></video>
      <button class="primary" onclick="renderIntro()">Volver al inicio</button>
    `;
  }else reiniciarSala();
}

function reiniciarSala(){
  p=0;letras=[];intentos=3;
  startTimer();renderPregunta();
}

renderIntro();
</script>
</body>
</html>
